---
title: OWASP CRS Request Action
sidebarTitle: OWASP CRS Request
description: The OWASP CRS Request Traffic Policy action enables OWASP CRS for use with ModSecurity or compatible web application firewalls.
---

import ActionExamples from "/snippets/traffic-policy/actions/owasp-crs-request/examples/index.mdx";
import ActionVariablesDescription from "/snippets/traffic-policy/common/action-variables-description.mdx";
import { YouTubeEmbed } from "/snippets/YouTubeEmbed.jsx";

import { ConfigField } from "/snippets/ConfigTable.jsx";
import { ConfigChildren } from "/snippets/ConfigChildren.jsx";

The **OWASP CRS Request** Traffic Policy action enables OWASP (Open Worldwide Application
Security Project) CRS (previously Core Rule Set), a set of generic attack detection
rules for use with ModSecurity or compatible web application firewalls. It aims to protect
web applications from a wide range of attacks, including the
[OWASP Top Ten](https://owasp.org/www-project-top-ten/), with a minimum of false alerts.
CRS provides protection against many common attack categories, including SQL Injection,
Cross Site Scripting, Local File Inclusion, etc.

The `owasp-crs-request` action only enables rule processing on _incoming_ HTTP requests to your
endpoint. In addition to this action, we also recommend you enable the [OWASP CRS Response
action](/traffic-policy/actions/owasp-crs-response/) to analyze _outgoing_ HTTP responses from your endpoint.


## Video walkthrough

The following video walks you through ngrok's OWASP CRS request and response actions in Traffic Policy, which let you add web application firewall protection directly to your ngrok endpoints without changing your existing infrastructure.

<YouTubeEmbed videoId="HHxj5VGFTEA" title="Block web attacks with ngrok's OWASP CRS Request" />

<ActionOverview />

### Configuration Reference

This is the [Traffic Policy](/docs/traffic-policy/) configuration
reference for this action.

#### Supported Phases

`on_http_request`

#### Type

`owasp-crs-request`

#### Configuration Fields

<ConfigField title="on_error" type="string" required={true}>
    <p>Behavior if there is an error. Must be one of either "continue" or "halt" (default "halt")</p>
    <p>More information can be found in the [Managing Fallback Behavior](#on-error) section.</p>
</ConfigField>

<ConfigField title="process_body" type="bool" required={false}>
    <p>If false, we do not process rules for the request body. Default is false.</p>
</ConfigField>

<ConfigField title="exclude_rule_ids" type="array of integers" required={false}>
    <p>List of OWASP CRS rule IDs to exclude from evaluation.</p>
    <p>The minimum value is <code>900000</code> and the maximum value is <code>999999</code>.</p>
</ConfigField>



## Behavior

This action evaluates rules for request headers and body (when `process_body` is enabled), and each matching rule adds to the overall score of a request. If the score exceeds the set score threshold, the action will block the request.

The tallying process is called Anomaly Scoring, and is detailed on [the CRS website.](https://coreruleset.org/docs/2-how-crs-works/2-1-anomaly_scoring/)

### Default Behavior

The default behavior for this action is based on the following [Coraza](https://coraza.io/) directives and rules from v4.14.0 of the CRS:

- [coraza.conf-recommended](https://github.com/corazawaf/coraza/blob/main/coraza.conf-recommended)
- [crs-setup.conf.example](https://github.com/corazawaf/coraza-coreruleset/blob/main/rules/%40crs-setup.conf.example)
- [@owasp_crs/\*.conf](https://github.com/corazawaf/coraza-coreruleset/tree/main/rules/%40owasp_crs)

Included in these rules is an inbound anomaly score threshold of 5 and a [paranoia level](https://coreruleset.org/docs/2-how-crs-works/2-2-paranoia_levels/) of 1.

### Managing Fallback Behavior (`on_error`) 

If `on_error` is set to `halt` (default) and the action encounters an error when forwarding traffic, the Traffic Policy chain will halt and no further actions will be executed. For example, if you have a `log` action after the `owasp-crs-request` action, the `log` action will not be run and the error will be returned.

However, if `on_error` is set to `continue`, actions that appear after the `owasp-crs-request` action will still be executed even if the `owasp-crs-request` action encounters an error.

### Body Processing

When `process_body` is enabled, ngrok evaluates rules against the first 4kb of the body. If the body is larger than 4kb, we ignore the portion after the first 4kb.

### Rule Exclusion

When `exclude_rule_ids` is configured, ngrok skips evaluation of the specified rule IDs. This allows you to disable specific OWASP CRS rules that may be causing false positives in your environment.

### Inbound Anomaly Score Threshold Exceeded

If the anomaly score accumulated from matching rules exceeds the threshold, ngrok blocks the request with a `HTTP 403` response. The request does not make it to your upstream.

### Failure to process the body successfully

If ngrok is unable to read the request body successfully, ngrok blocks the request with a `HTTP 500` response. The request does not make it to your upstream.


<ActionExamples />

## Action Result Variables

<ActionVariablesDescription />

	<ConfigField title="actions.ngrok.owasp_crs_request.decision" type="string">
		<p>The action taken for this request.</p>
        <ConfigEnum label="Possible values">
            <ConfigEnumOption>`allow` - If the request was permitted.</ConfigEnumOption>
            <ConfigEnumOption>`deny` - If the request was denied.</ConfigEnumOption>
        </ConfigEnum>
	</ConfigField>
	<ConfigField title="actions.ngrok.owasp_crs_request.anomaly_score" type="int">
		<p>
			The total anomaly score for the request. If it equals to or exceeds the set threshold, it will
            block the request.
		</p>
	</ConfigField>
    	<ConfigField title="actions.ngrok.owasp_crs_request.anomaly_score_threshold" type="int">
		<p>
			The total anomaly score threshold for the request. By default, it is set to 5.
		</p>
	</ConfigField>
	<ConfigField
		title="actions.ngrok.owasp_crs_request.matched_rules"
		type="array of objects"
	>
		<p>The list of all rules matched by this request that have a non-zero score.</p>
		<ConfigChildren>
			<ConfigField title="matched_rules[i].id" type="int">
				<p>
					The ID of the rule.
				</p>
			</ConfigField>
			<ConfigField title="matched_rules[i].message" type="string">
				<p>
					The text message describing the rule.
				</p>
			</ConfigField>
			<ConfigField title="matched_rules[i].severity" type="string">
				<p>
					The [severity](https://coraza.io/docs/seclang/actions/#severity) of the matched rule. 
				</p>
			</ConfigField>
			<ConfigField title="matched_rules[i].data" type="string">
				<p>
					Any extra data about the rule and how it matched the request.
				</p>
			</ConfigField>
		</ConfigChildren>
	</ConfigField>
	<ConfigField title="actions.ngrok.owasp_crs_request.error.code" type="string">
		<p>
			A machine-readable code describing an error that occurred during the
			action's execution.
		</p>
	</ConfigField>
	<ConfigField title="actions.ngrok.owasp_crs_request.error.message" type="string">
		<p>
			A human-readable message providing details about an error that occurred
			during the action's execution.
		</p>
	</ConfigField>
