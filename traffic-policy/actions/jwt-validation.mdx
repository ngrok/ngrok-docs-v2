---
title: JWT Validation
---

import ActionVariablesDescription from "/snippets/traffic-policy/common/action-variables-description.mdx";
import { ConfigField } from "/snippets/ConfigTable.jsx";
import { ConfigChildren } from "/snippets/ConfigChildren.jsx";


The **JWT Validation** Traffic Policy action enables you to validate JSON Web
Tokens (JWT) on your endpoints before routing traffic to your upstream service.

We have created guides for configuring this action with the following providers:

- [Auth0](/docs/integrations/auth0/jwt-action/)

A useful tool for working with JWTs is provided at [jwt.io](https://jwt.io).


## Configuration Reference

The [Traffic Policy](/traffic-policy/) configuration
reference for this action.

### Supported Phases

`on_http_request`

### Type

`jwt-validation`

### Configuration Fields

<ConfigField title="issuer" type="object" required={true}>
    <p>Configuration object for the Issuer(s) of the JWTs.</p>
    <ConfigChildren>
        <ConfigField title="allow_list" type="array of objects" required={true}>
            <p>List of allowed issuers. Minimum `1`.</p>
            <ConfigChildren>
                <ConfigField title="allow_list[*].value" type="string" required={true} cel={true}>
                    <p>Issuer URL. This can be found in the <code>iss</code> claim after decoding the JWT or from the <code>/.well-known/openid-configuration</code> endpoint in your Identity Provider.</p>
                    <p>Supports [CEL Interpolation](/traffic-policy/concepts/cel-interpolation).</p>
                </ConfigField>
            </ConfigChildren>
        </ConfigField>
    </ConfigChildren>
</ConfigField>

<ConfigField title="audience" type="object" required={false}>
    <p>Configuration object for the Audience(s) of the JWTs.</p>
    <ConfigChildren>
        <ConfigField title="allow_list" type="array of objects" required={false}>
            <p>List of allowed audiences. Minimum `1`.</p>
            <ConfigChildren>
                <ConfigField title="allow_list[*].value" type="string" required={false}>
                    <p>Audience claim value. This can be found in the <code>aud</code> claim after decoding the JWT or from the request used to create the token in the first place.</p>
                </ConfigField>
            </ConfigChildren>
        </ConfigField>
    </ConfigChildren>
</ConfigField>

<ConfigField title="http" type="object" required={true}>
    <p>Configuration object for the HTTP requests containing JWTs.</p>
    <ConfigChildren>
        <ConfigField title="tokens" type="array of objects" required={true}>
            <p>List of tokens to validate. Minimum `1`.</p>
            <ConfigChildren>
                <ConfigField title="tokens[*].type" type="enum" required={true}>
                    <p>Type of the JWT, which acts as a hint about how ngrok should parse the token.</p>
                    <ConfigEnum>
                        <ConfigEnumOption>`id_token`</ConfigEnumOption>
                        <ConfigEnumOption>`access_token`</ConfigEnumOption>
                        <ConfigEnumOption>`at+jwt`</ConfigEnumOption>
                        <ConfigEnumOption>`it+jwt`</ConfigEnumOption>
                        <ConfigEnumOption>`plain`</ConfigEnumOption>
                        <ConfigEnumOption>`jwt`</ConfigEnumOption>
                    </ConfigEnum>
                </ConfigField>
                <ConfigField title="tokens[*].method" type="enum" required={true}>
                    <p>Location in the request to expect the JWT.</p>
                    <ConfigEnum>
                        <ConfigEnumOption>`header`</ConfigEnumOption>
                        <ConfigEnumOption>`body`</ConfigEnumOption>
                    </ConfigEnum>
                    <p>When choosing `header`, the <code>content-type</code> header must be set to either <code>application/json</code> or <code>application/x-www-form-urlencoded</code>.</p>
                    <p>When choosing <code>body</code>, the method must be <code>POST</code>, <code>PUT</code>, or <code>PATCH</code></p>
                    <p>We do not support including a token as a URL query parameter.</p>
                </ConfigField>
                <ConfigField title="tokens[*].name" type="string" required={true} cel={true}>
                    <p>Name of the header or body field where the JWT is expected (Example: <code>"Authorization"</code>). This is not case sensitive.</p>
                    <p>Supports [CEL Interpolation](/traffic-policy/concepts/cel-interpolation).</p>
                </ConfigField>
                <ConfigField title="tokens[*].prefix" type="string" cel={true}>
                    <p>Any prefix to strip from the header or body field before parsing the JWT (Example: <code>"Bearer "</code>).</p>
                    <p>Supports [CEL Interpolation](/traffic-policy/concepts/cel-interpolation).</p>
                </ConfigField>
            </ConfigChildren>
        </ConfigField>
    </ConfigChildren>
</ConfigField>

<ConfigField title="jws" type="object" required={true}>
    <p>Configuration object for signed JWTs (JWS).</p>
    <ConfigChildren>
        <ConfigField title="allowed_algorithms" type="array of strings" required={true}>
            <p>List of allowed signing algorithms. We do not support <code>none</code> as a value here because it is insecure. Minimum `1`.</p>
        </ConfigField>
        <ConfigField title="keys" type="array of objects" required={true}>
            <p>Configuration for the JWT signing keys.</p>
            <ConfigChildren>
                <ConfigField title="keys[*].identification" type="array of objects" required={false}>
                    <p>JWT metadata.</p>
                    <ConfigChildren>
                        <ConfigField title="keys[*].identification[*].token_claims" type="array of strings" required={false}>
                            <p>List of claims present in this token. Supported values: ['kid']</p>
                        </ConfigField>
                    </ConfigChildren>
                </ConfigField>
                <ConfigField title="keys[*].sources" type="array of objects" required={true}>
                    <p>Configuration for the key material used to verify the signed JWTs.</p>
                    <ConfigChildren>
                        <ConfigField title="keys[*].sources[*].additional_jkus" type="array of strings" required={true} cel={true}>
                            <p>List of URLs which serve the possible signing keys in JWKS format. These URLs are cached and refreshed roughly every 15 minutes.</p>
                            <p>Supports [CEL Interpolation](/traffic-policy/concepts/cel-interpolation).</p>
                        </ConfigField>
                    </ConfigChildren>
                </ConfigField>
            </ConfigChildren>
        </ConfigField>
    </ConfigChildren>
</ConfigField>



## Behavior

### Request Validation

The request is allowed only if it has been correctly signed by the issuer and
the defined claims match.

For efficient validation of tokens, it is recommended to include the optional
`kid` claim in your JWTs and JWK payload.

Custom validation can be implemented in Traffic Policies via the
[`actions.ngrok.jwt_validation.tokens`](#action-result-variables) Action Result Variable and its
corresponding properties.

### Multiple Issuers

You can specify multiple issuers for JWT validation. A request is
considered validated if it presents a JWT signed by any of the specified
issuers.

The issuer **must** exactly match the one provided in the JWT, including
any trailing slashes (`/`) present in the `iss` claim.

### Multiple Audience Claims

You can optionally specify one or more audience (`aud`) claims for JWT validation.

If present, the `aud` claim **must** contain at least one of the specified audience claims and
exactly match for validation to succeed.

### Multiple Signing Keys

You can provide multiple JSON Web Key Set (JWKS) URLs and signing algorithms.

During JWT validation the list of JWKS and algorithms provided will be used in
an attempt to validate the JWT. The list will be tried in order and is cached
for performance. The cache is refreshed roughly every 15 minutes.

### Multiple Tokens

If multiple tokens are defined within the HTTP configuration parameter, all
tokens **must** be present in the request. If all tokens are not present, a
`401 Unauthorized` status code will be returned.

## Examples

### Basic Example

The following [Traffic Policy](/docs/traffic-policy/)
configuration is an example configuration of the `jwt-validation` action. For a
more real-world example, check out our [Auth0 guide](/docs/integrations/auth0/jwt-action/).

#### Example Traffic Policy Document

<CodeGroup>
```yaml policy.yml {4-28}
on_http_request:
  - actions:
      - type: jwt-validation
        config:
          issuer:
            allow_list:
              - value: https://example.com/issuer
          audience:
            allow_list:
              - value: urn:example:api
          http:
            tokens:
              - type: access_token
                method: header
                name: Authorization
                prefix: 'Bearer '
              - type: it+jwt
                method: body
                name: _id_token
          jws:
            allowed_algorithms:
              - RS256
              - ES256
            keys:
              sources:
                additional_jkus:
                  - https://example.com/issuer/jku
```

```json policy.json {5-51}
{
  "on_http_request": [
    {
      "actions": [
        {
          "type": "jwt-validation",
          "config": {
            "issuer": {
              "allow_list": [
                {
                  "value": "https://example.com/issuer"
                }
              ]
            },
            "audience": {
              "allow_list": [
                {
                  "value": "urn:example:api"
                }
              ]
            },
            "http": {
              "tokens": [
                {
                  "type": "access_token",
                  "method": "header",
                  "name": "Authorization",
                  "prefix": "Bearer "
                },
                {
                  "type": "it+jwt",
                  "method": "body",
                  "name": "_id_token"
                }
              ]
            },
            "jws": {
              "allowed_algorithms": [
                "RS256",
                "ES256"
              ],
              "keys": {
                "sources": {
                  "additional_jkus": [
                    "https://example.com/issuer/jku"
                  ]
                }
              }
            }
          }
        }
      ]
    }
  ]
}
```
</CodeGroup>

#### Example Request

```bash
$ curl --request GET \
  --url http://example-api.ngrok.app/ \
  --header 'authorization: Bearer <VALID-JWT>'
```

```http
HTTP/2 200 OK
content-type: text/html

...
```

In this example, we are sending a request to our API with a valid JWT token in
the `Authorization` header with the `Bearer` prefix and getting back a `200 OK`
response.


## Action Result Variables

<ActionVariablesDescription />

	<ConfigField
		title="actions.ngrok.jwt_validation.tokens"
		type="array of objects"
	>
		<p>The list of JSON Web Tokens (JWTs) processed by the action.</p>
		<ConfigChildren>
			<ConfigField title="tokens[i].header" type="object">
				<p>
					The header portion of the JWT, parsed into a key-value map containing
					metadata about the token.
				</p>
			</ConfigField>
			<ConfigField title="tokens[i].location" type="string">
				<p>
					The part of the HTTP request where the JWT was located (e.g.,{" "}
					<code>header</code>, <code>body</code>).
				</p>
			</ConfigField>
			<ConfigField title="tokens[i].location_property" type="string">
				<p>
					The specific header or body field that contained the JWT (e.g.,{" "}
					<code>"Authorization"</code>).
				</p>
			</ConfigField>
			<ConfigField title="tokens[i].payload" type="object">
				<p>
					The payload portion of the JWT, parsed into a key-value map
					representing the claims.
				</p>
			</ConfigField>
			<ConfigField title="tokens[i].signature" type="string">
				<p>
					The signature portion of the JWT, encoded in base64, used for
					verifying token integrity.
				</p>
			</ConfigField>
			<ConfigField title="tokens[i].verified" type="boolean">
				<p>
					Indicates whether the token passed verification. Returns{" "}
					<code>true</code> if verified successfully.
				</p>
			</ConfigField>
		</ConfigChildren>
	</ConfigField>
	<ConfigField title="actions.ngrok.jwt_validation.error.code" type="string">
		<p>
			A machine-readable code describing an error that occurred during the
			action's execution.
		</p>
	</ConfigField>
	<ConfigField title="actions.ngrok.jwt_validation.error.message" type="string">
		<p>
			A human-readable message providing details about an error that occurred
			during the action's execution.
		</p>
	</ConfigField>